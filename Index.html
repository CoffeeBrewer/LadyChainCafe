<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LadyChain CafÃ© Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="background-overlay"></div>

    <header class="top-bar">
        <div class="logo-area">
            <div class="logo-circle">
                <span class="logo-initials">LC</span>
            </div>
            <div class="logo-text">
                <span class="logo-main">LadyChain CafÃ©</span>
                <span class="logo-sub">Explorer dashboard for LadyChain</span>
            </div>
        </div>
        <div class="network-pill">
            <span class="dot"></span>
            <span id="network-name">LadyChain Mainnet</span>
        </div>
    </header>

    <main class="dashboard-container">
        <section class="hero fade-in">
            <div>
                <h1>Welcome to the LadyChain CafÃ©</h1>
                <p class="hero-subtitle">
                    Grab a coffee and watch LadyChain grow â€” blocks, wallets, transactions,
                    gas and network health, all in real time.
                </p>
            </div>

            <div class="hero-badge">
                <span class="badge-label">Live network health</span>
                <span id="last-updated" class="badge-value skeleton">Loadingâ€¦</span>
            </div>
        </section>

        <!-- MAIN STATS CARDS -->
        <section class="cards fade-in">
            <article class="card">
                <div class="card-header">
                    <span class="card-icon">ðŸ“¦</span>
                    <h2>Blocks</h2>
                </div>
                <p class="card-label">Total blocks on LadyChain</p>
                <p id="block-count" class="card-value skeleton">â€“</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">ðŸ‘›</span>
                    <h2>Wallets</h2>
                </div>
                <p class="card-label">Unique LadyChain addresses</p>
                <p id="wallet-count" class="card-value skeleton">â€“</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">ðŸ’¸</span>
                    <h2>Total Transactions</h2>
                </div>
                <p class="card-label">All transactions on LadyChain</p>
                <p id="transaction-count" class="card-value skeleton">â€“</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">â˜•</span>
                    <h2>Transactions Today</h2>
                </div>
                <p class="card-label">Daily activity on LadyChain</p>
                <p id="transaction-today" class="card-value skeleton">â€“</p>
            </article>
        </section>

        <!-- NETWORK METRICS STRIP -->
        <section class="metrics-row fade-in">
            <div class="metric-pill">
                <span class="metric-label">Avg block time</span>
                <span id="metric-avg-block-time" class="metric-value skeleton">â€“</span>
            </div>
            <div class="metric-pill">
                <span class="metric-label">Approx. TPS</span>
                <span id="metric-tps" class="metric-value skeleton">â€“</span>
            </div>
            <div class="metric-pill">
                <span class="metric-label">Network utilization</span>
                <span id="metric-utilization" class="metric-value skeleton">â€“</span>
            </div>
            <div class="metric-pill">
                <span class="metric-label">TVL</span>
                <span id="metric-tvl" class="metric-value skeleton">â€“</span>
            </div>
        </section>

        <!-- DAILY GROWTH (TX) + GAS -->
        <section class="panel fade-in">
            <div class="panel-header">
                <div>
                    <h2>LadyChain Daily Growth</h2>
                    <p class="panel-subtitle">
                        Transactions per day â€” see how active LadyChain is over time.
                    </p>
                </div>
            </div>
            <div class="panel-body">
                <canvas id="growthChart"></canvas>

                <div class="gas-badges">
                    <div class="gas-badge">
                        <span class="gas-label">Low gas</span>
                        <span id="gas-low" class="gas-value skeleton">â€“</span>
                    </div>
                    <div class="gas-badge">
                        <span class="gas-label">Average gas</span>
                        <span id="gas-avg" class="gas-value skeleton">â€“</span>
                    </div>
                    <div class="gas-badge">
                        <span class="gas-label">High gas</span>
                        <span id="gas-high" class="gas-value skeleton">â€“</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- NEW WALLETS PER DAY (optional, only if API provides it) -->
        <section class="panel fade-in">
            <div class="panel-header">
                <div>
                    <h2>New LadyChain Wallets per Day</h2>
                    <p class="panel-subtitle">
                        Newly created addresses over time on LadyChain.
                    </p>
                </div>
            </div>
            <div class="panel-body">
                <canvas id="walletsChart"></canvas>
                <p id="walletsChart-empty" class="placeholder" style="display: none;">
                    No wallet growth data available (yet).
                </p>
            </div>
        </section>

        <section class="two-column">
            <!-- LATEST TX -->
            <section class="panel fade-in">
                <div class="panel-header">
                    <div>
                        <h2>Latest LadyChain Transactions</h2>
                        <p class="panel-subtitle">
                            The most recent transfers and contract interactions on LadyChain.
                        </p>
                    </div>
                </div>
                <div class="panel-body table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Hash</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Value</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="latest-transactions-body">
                            <tr><td colspan="5" class="placeholder">Loading latest transactionsâ€¦</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- RICHEST WALLETS -->
            <section class="panel fade-in">
                <div class="panel-header">
                    <div>
                        <h2>Richest LadyChain Wallets</h2>
                        <p class="panel-subtitle">
                            Top addresses by balance on LadyChain.
                        </p>
                    </div>
                </div>
                <div class="panel-body table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Address</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="top-accounts-body">
                            <tr><td colspan="3" class="placeholder">Loading top walletsâ€¦</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </section>
    </main>

    <footer class="footer">
        Brewed with â˜• & ðŸ’» â€” live data from <code>ladyscan.us</code>
    </footer>

    <!-- DETAIL DRAWER -->
    <div id="detail-overlay" class="detail-overlay hidden">
        <div class="detail-backdrop" onclick="closeDetail()"></div>
        <aside class="detail-panel">
            <button class="detail-close" type="button" onclick="closeDetail()">Ã—</button>
            <div id="detail-content" class="detail-content">
                <!-- Filled by JS -->
            </div>
        </aside>
    </div>

    <script>
        const API_BASE = "https://ladyscan.us/api/v2";

        function formatNumber(value) {
            if (value === null || value === undefined || value === "" || isNaN(value)) {
                return "â€“";
            }
            const num = Number(value);
            return Number(num.toFixed(2)).toLocaleString("en-US");
        }

        function from18(value) {
            if (value === null || value === undefined) return 0;
            try {
                const n = BigInt(value);
                const factor = BigInt("1000000000000000000");
                const whole = Number(n / factor);
                const decimal = Number(n % factor) / 1e18;
                return whole + decimal;
            } catch {
                return Number(value) / 1e18;
            }
        }

        function shortenHash(hash, length = 10) {
            if (!hash) return "â€“";
            if (hash.length <= length) return hash;
            return hash.slice(0, 6) + "â€¦" + hash.slice(-4);
        }

        function formatTimestamp(ts) {
            if (!ts) return "â€“";

            const num = Number(ts);
            if (!isNaN(num)) {
                const ms = num < 1e12 ? num * 1000 : num;
                const d = new Date(ms);
                if (!isNaN(d.getTime())) return d.toLocaleString("en-GB");
            }

            const d2 = new Date(ts);
            if (!isNaN(d2.getTime())) return d2.toLocaleString("en-GB");

            return String(ts);
        }

        function clearSkeleton(idOrEl) {
            const el = typeof idOrEl === "string" ? document.getElementById(idOrEl) : idOrEl;
            if (el) el.classList.remove("skeleton");
        }

        async function fetchJson(path, params = "") {
            const url = API_BASE + path + params;
            const response = await fetch(url);
            if (!response.ok) throw new Error("API error " + response.status + " at " + url);
            return response.json();
        }

        // ========== MAIN STATS + METRICS ==========
        async function loadStats() {
            try {
                const data = await fetchJson("/stats");

                const blocks = data.total_blocks;
                const addresses = data.total_addresses;
                const totalTx = data.total_transactions;
                const txToday = Number(data.transactions_today || 0);
                const avgBlockTime = data.average_block_time || data.avg_block_time;
                const utilization = data.network_utilization_percentage;
                const tvl = data.tvl;

                document.getElementById("block-count").innerText = formatNumber(blocks);
                document.getElementById("wallet-count").innerText = formatNumber(addresses);
                document.getElementById("transaction-count").innerText = formatNumber(totalTx);
                document.getElementById("transaction-today").innerText = formatNumber(txToday);

                clearSkeleton("block-count");
                clearSkeleton("wallet-count");
                clearSkeleton("transaction-count");
                clearSkeleton("transaction-today");

                const tps = txToday / 86400;
                document.getElementById("metric-avg-block-time").innerText =
                    avgBlockTime ? formatNumber(avgBlockTime) + " s" : "â€“";
                document.getElementById("metric-tps").innerText = formatNumber(tps);
                document.getElementById("metric-utilization").innerText =
                    (utilization !== null && utilization !== undefined)
                        ? formatNumber(utilization) + " %"
                        : "â€“";
                document.getElementById("metric-tvl").innerText =
                    (tvl !== null && tvl !== undefined) ? formatNumber(tvl) : "â€“";

                clearSkeleton("metric-avg-block-time");
                clearSkeleton("metric-tps");
                clearSkeleton("metric-utilization");
                clearSkeleton("metric-tvl");

                const updated = document.getElementById("last-updated");
                updated.innerText = "Updated: " + new Date().toLocaleTimeString("en-GB");
                clearSkeleton(updated);
            } catch (err) {
                console.error("loadStats error:", err);
            }
        }

        // ========== CHARTS (TX + NEW WALLETS + GAS) ==========
        async function loadCharts() {
            try {
                const data = await fetchJson("/stats/charts");

                // Daily tx
                const daily = data.daily_transactions || [];
                daily.sort((a, b) => new Date(a.date) - new Date(b.date));

                const labels = daily.map((item) => {
                    const d = new Date(item.date);
                    return d.toLocaleDateString("en-GB", {
                        day: "2-digit",
                        month: "short"
                    });
                });

                const values = daily.map((item) => Number(item.count) || 0);

                const txCtx = document.getElementById("growthChart").getContext("2d");
                new Chart(txCtx, {
                    type: "line",
                    data: {
                        labels,
                        datasets: [
                            {
                                label: "Daily transactions",
                                data: values,
                                borderWidth: 2,
                                tension: 0.25,
                                pointRadius: 3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

                // Gas bands
                if (data.low_gas !== undefined) {
                    const low = formatNumber(data.low_gas) + " gwei";
                    const avg = formatNumber(data.avg_gas_price || data.avg_gas) + " gwei";
                    const high = formatNumber(data.high_gas) + " gwei";

                    const elLow = document.getElementById("gas-low");
                    const elAvg = document.getElementById("gas-avg");
                    const elHigh = document.getElementById("gas-high");

                    elLow.innerText = low;
                    elAvg.innerText = avg;
                    elHigh.innerText = high;

                    clearSkeleton(elLow);
                    clearSkeleton(elAvg);
                    clearSkeleton(elHigh);
                }

                // New wallets per day (if backend provides it)
                const walletsArray =
                    data.daily_new_addresses ||
                    data.daily_wallets ||
                    data.new_wallets ||
                    [];

                if (walletsArray.length && document.getElementById("walletsChart")) {
                    walletsArray.sort((a, b) => new Date(a.date) - new Date(b.date));
                    const wLabels = walletsArray.map((item) => {
                        const d = new Date(item.date);
                        return d.toLocaleDateString("en-GB", {
                            day: "2-digit",
                            month: "short"
                        });
                    });
                    const wValues = walletsArray.map((item) =>
                        Number(item.count || item.value || item.addresses || 0)
                    );

                    const wCtx = document.getElementById("walletsChart").getContext("2d");
                    new Chart(wCtx, {
                        type: "bar",
                        data: {
                            labels: wLabels,
                            datasets: [
                                {
                                    label: "New wallets per day",
                                    data: wValues,
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                } else {
                    const emptyEl = document.getElementById("walletsChart-empty");
                    if (emptyEl) emptyEl.style.display = "block";
                }
            } catch (err) {
                console.error("loadCharts error:", err);
            }
        }

        // ========== LATEST TRANSACTIONS ==========
        async function loadLatestTransactions() {
            try {
                const data = await fetchJson("/main-page/transactions");
                const tbody = document.getElementById("latest-transactions-body");
                tbody.innerHTML = "";

                const items = data.items || [];
                if (!items.length) {
                    tbody.innerHTML =
                        '<tr><td colspan="5" class="placeholder">No transactions found</td></tr>';
                    return;
                }

                items.slice(0, 10).forEach((tx) => {
                    let displayValue;
                    if (tx.value_formatted !== undefined && tx.value_formatted !== null) {
                        displayValue = Number(tx.value_formatted);
                    } else {
                        displayValue = from18(tx.value || 0);
                    }

                    const timestampRaw =
                        tx.created_at || tx.updated_at || tx.timestamp || tx.time || tx.block_time;

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td title="${tx.hash}">
                            <button class="link-button" onclick="openTxDetail('${tx.hash}')">
                                ${shortenHash(tx.hash)}
                            </button>
                        </td>
                        <td title="${tx.from_address}">
                            <button class="link-button" onclick="openAddressDetail('${tx.from_address}')">
                                ${shortenHash(tx.from_address)}
                            </button>
                        </td>
                        <td title="${tx.to_address}">
                            <button class="link-button" onclick="openAddressDetail('${tx.to_address}')">
                                ${shortenHash(tx.to_address)}
                            </button>
                        </td>
                        <td>${formatNumber(displayValue)}</td>
                        <td>${formatTimestamp(timestampRaw)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error("loadLatestTransactions error:", err);
                const tbody = document.getElementById("latest-transactions-body");
                tbody.innerHTML =
                    '<tr><td colspan="5" class="placeholder">Error while loading transactions</td></tr>';
            }
        }

        // ========== TOP ACCOUNTS ==========
        async function loadTopAccounts() {
            try {
                const data = await fetchJson("/stats/top-accounts");
                const tbody = document.getElementById("top-accounts-body");
                tbody.innerHTML = "";

                const items = data.items || [];
                if (!items.length) {
                    tbody.innerHTML =
                        '<tr><td colspan="3" class="placeholder">No data found</td></tr>';
                    return;
                }

                items.slice(0, 10).forEach((acc, index) => {
                    const balance = from18(acc.balance || 0);
                    const addr = acc.address || acc.account || acc.wallet || "";

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td title="${addr}">
                            <button class="link-button" onclick="openAddressDetail('${addr}')">
                                ${shortenHash(addr, 14)}
                            </button>
                        </td>
                        <td>${formatNumber(balance)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error("loadTopAccounts error:", err);
                const tbody = document.getElementById("top-accounts-body");
                tbody.innerHTML =
                    '<tr><td colspan="3" class="placeholder">Error while loading top wallets</td></tr>';
            }
        }

        // ========== DETAIL OVERLAY HELPERS ==========
        function openTxDetail(hash) {
            openDetail("transaction", hash);
        }

        function openAddressDetail(address) {
            openDetail("address", address);
        }

        async function openDetail(type, id) {
            const overlay = document.getElementById("detail-overlay");
            const content = document.getElementById("detail-content");
            overlay.classList.remove("hidden");
            content.innerHTML = `<p class="placeholder">Loading ${type} detailsâ€¦</p>`;

            try {
                if (type === "transaction") {
                    const tx = await fetchJson(`/transactions/${id}`);
                    await renderTxDetail(tx);
                } else {
                    const addr = await fetchJson(`/addresses/${id}`);
                    await renderAddressDetail(addr);
                }
            } catch (err) {
                console.error("openDetail error:", err);
                content.innerHTML =
                    `<p class="placeholder">Error while loading ${type} details.</p>`;
            }
        }

        function closeDetail() {
            const overlay = document.getElementById("detail-overlay");
            overlay.classList.add("hidden");
        }

        function initDetailTabs() {
            const tabs = document.querySelectorAll(".detail-tab");
            tabs.forEach(tab => {
                tab.addEventListener("click", () => {
                    const target = tab.dataset.tab;
                    tabs.forEach(t => t.classList.remove("active"));
                    document.querySelectorAll(".detail-section").forEach(sec => sec.classList.remove("active"));
                    tab.classList.add("active");
                    document.getElementById(target).classList.add("active");
                });
            });
        }

        // ========== TRANSACTION DETAIL RENDER ==========
        async function renderTxDetail(tx) {
            const content = document.getElementById("detail-content");

            let displayValue =
                tx.value_formatted !== undefined && tx.value_formatted !== null
                    ? Number(tx.value_formatted)
                    : from18(tx.value || 0);

            const gasPriceGwei = tx.gas_price ? Number(tx.gas_price) / 1e9 : null;
            const created = tx.created_at || tx.timestamp || tx.time;

            content.innerHTML = `
                <h2 class="detail-title">Transaction details</h2>
                <p class="detail-id">${tx.hash || "Unknown hash"}</p>

                <div class="detail-tabs">
                    <div class="detail-tab active" data-tab="tx-overview">Overview</div>
                    <div class="detail-tab" data-tab="tx-logs">Logs</div>
                    <div class="detail-tab" data-tab="tx-internal">Internal Tx</div>
                    <div class="detail-tab" data-tab="tx-raw">Raw JSON</div>
                </div>

                <div id="tx-overview" class="detail-section active">
                    <div class="detail-grid">
                        <div>
                            <span class="detail-label">Status</span>
                            <span class="detail-value">
                                ${tx.status === 1 || tx.success ? "Success" : "Failed / Unknown"}
                            </span>
                        </div>
                        <div>
                            <span class="detail-label">Block</span>
                            <span class="detail-value">${tx.block_number || "â€“"}</span>
                        </div>
                        <div>
                            <span class="detail-label">From</span>
                            <span class="detail-value mono">${tx.from_address || "â€“"}</span>
                        </div>
                        <div>
                            <span class="detail-label">To</span>
                            <span class="detail-value mono">${tx.to_address || "â€“"}</span>
                        </div>
                        <div>
                            <span class="detail-label">Value</span>
                            <span class="detail-value">${formatNumber(displayValue)}</span>
                        </div>
                        <div>
                            <span class="detail-label">Gas used</span>
                            <span class="detail-value">${formatNumber(tx.gas_used || tx.gas || 0)}</span>
                        </div>
                        <div>
                            <span class="detail-label">Gas price</span>
                            <span class="detail-value">
                                ${gasPriceGwei !== null ? formatNumber(gasPriceGwei) + " gwei" : "â€“"}
                            </span>
                        </div>
                        <div>
                            <span class="detail-label">Timestamp</span>
                            <span class="detail-value">
                                ${created ? formatTimestamp(created) : "â€“"}
                            </span>
                        </div>
                    </div>
                </div>

                <div id="tx-logs" class="detail-section">
                    <p class="placeholder">Loading logsâ€¦</p>
                </div>

                <div id="tx-internal" class="detail-section">
                    <p class="placeholder">Loading internal transactionsâ€¦</p>
                </div>

                <div id="tx-raw" class="detail-section">
                    <div class="detail-json">${JSON.stringify(tx, null, 2)}</div>
                </div>
            `;

            initDetailTabs();

            // Logs
            try {
                const logs = await fetchJson(`/transactions/${tx.hash}/logs`);
                const logsContainer = document.getElementById("tx-logs");

                if (!logs.items || !logs.items.length) {
                    logsContainer.innerHTML = `<p class="placeholder">No logs</p>`;
                } else {
                    logsContainer.innerHTML = `
                        <table class="detail-table">
                            <thead>
                                <tr><th>#</th><th>Event</th><th>Topics</th><th>Data</th></tr>
                            </thead>
                            <tbody>
                                ${logs.items
                                    .map(
                                        (log, i) => `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td>${(log.decoded && log.decoded.name) || log.event || "Unknown"}</td>
                                        <td>${(log.topics || []).join("<br>")}</td>
                                        <td>${log.data || "â€“"}</td>
                                    </tr>`
                                    )
                                    .join("")}
                            </tbody>
                        </table>
                    `;
                }
            } catch (err) {
                console.error("logs error:", err);
                document.getElementById("tx-logs").innerHTML = `<p class="placeholder">Error loading logs</p>`;
            }

            // Internal tx
            try {
                const internals = await fetchJson(`/transactions/${tx.hash}/internal-transactions`);
                const internalContainer = document.getElementById("tx-internal");

                if (!internals.items || !internals.items.length) {
                    internalContainer.innerHTML = `<p class="placeholder">No internal transactions</p>`;
                } else {
                    internalContainer.innerHTML = `
                        <table class="detail-table">
                            <thead>
                                <tr><th>#</th><th>Type</th><th>From</th><th>To</th><th>Value</th></tr>
                            </thead>
                            <tbody>
                                ${internals.items
                                    .map(
                                        (itx, i) => `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td>${itx.type || "call"}</td>
                                        <td class="mono">${itx.from}</td>
                                        <td class="mono">${itx.to}</td>
                                        <td>${formatNumber(from18(itx.value || 0))}</td>
                                    </tr>`
                                    )
                                    .join("")}
                            </tbody>
                        </table>
                    `;
                }
            } catch (err) {
                console.error("internal tx error:", err);
                document.getElementById("tx-internal").innerHTML = `<p class="placeholder">Error loading internal tx</p>`;
            }
        }

        // ========== WALLET DETAIL RENDER ==========
        async function renderAddressDetail(addr) {
            const content = document.getElementById("detail-content");

            const address =
                addr.address || addr.account || addr.wallet || addr.id || "Unknown address";
            const balanceRaw = addr.balance || addr.value || 0;
            const balance = from18(balanceRaw);
            const txCount = addr.tx_count || addr.transaction_count || addr.transactions_count || "â€“";
            const firstSeen = addr.first_tx_at || addr.first_seen || addr.created_at;
            const lastSeen = addr.last_tx_at || addr.last_seen || addr.updated_at;

            content.innerHTML = `
                <h2 class="detail-title">Wallet details</h2>
                <p class="detail-id mono">${address}</p>

                <div class="detail-tabs">
                    <div class="detail-tab active" data-tab="addr-overview">Overview</div>
                    <div class="detail-tab" data-tab="addr-balances">Balances</div>
                    <div class="detail-tab" data-tab="addr-transfers">Token Transfers</div>
                    <div class="detail-tab" data-tab="addr-raw">Raw JSON</div>
                </div>

                <div id="addr-overview" class="detail-section active">
                    <div class="detail-grid">
                        <div>
                            <span class="detail-label">Balance</span>
                            <span class="detail-value">${formatNumber(balance)}</span>
                        </div>
                        <div>
                            <span class="detail-label">Total transactions</span>
                            <span class="detail-value">${txCount}</span>
                        </div>
                        <div>
                            <span class="detail-label">First seen</span>
                            <span class="detail-value">
                                ${firstSeen ? formatTimestamp(firstSeen) : "â€“"}
                            </span>
                        </div>
                        <div>
                            <span class="detail-label">Last activity</span>
                            <span class="detail-value">
                                ${lastSeen ? formatTimestamp(lastSeen) : "â€“"}
                            </span>
                        </div>
                    </div>
                </div>

                <div id="addr-balances" class="detail-section">
                    <p class="placeholder">Loading token balancesâ€¦</p>
                </div>

                <div id="addr-transfers" class="detail-section">
                    <p class="placeholder">Loading token transfersâ€¦</p>
                </div>

                <div id="addr-raw" class="detail-section">
                    <div class="detail-json">${JSON.stringify(addr, null, 2)}</div>
                </div>
            `;

            initDetailTabs();

            // Token balances
            try {
                const balances = await fetchJson(`/addresses/${address}/token-balances`);
                const balDiv = document.getElementById("addr-balances");

                if (!balances.items || !balances.items.length) {
                    balDiv.innerHTML = `<p class="placeholder">No tokens</p>`;
                } else {
                    balDiv.innerHTML = `
                        <table class="detail-table">
                            <thead>
                                <tr><th>Token</th><th>Symbol</th><th>Balance</th></tr>
                            </thead>
                            <tbody>
                                ${balances.items
                                    .map(
                                        t => `
                                    <tr>
                                        <td>${t.name || "Unknown"}</td>
                                        <td>${t.symbol || "?"}</td>
                                        <td>${formatNumber(from18(t.balance || 0))}</td>
                                    </tr>`
                                    )
                                    .join("")}
                            </tbody>
                        </table>
                    `;
                }
            } catch (err) {
                console.error("balances error:", err);
                document.getElementById("addr-balances").innerHTML =
                    `<p class="placeholder">Error loading balances</p>`;
            }

            // Token transfers
            try {
                const transfers = await fetchJson(`/addresses/${address}/token-transfers`);
                const trDiv = document.getElementById("addr-transfers");

                if (!transfers.items || !transfers.items.length) {
                    trDiv.innerHTML = `<p class="placeholder">No token transfers</p>`;
                } else {
                    trDiv.innerHTML = `
                        <table class="detail-table">
                            <thead>
                                <tr><th>Hash</th><th>From</th><th>To</th><th>Token</th><th>Value</th></tr>
                            </thead>
                            <tbody>
                                ${transfers.items
                                    .map(
                                        t => `
                                    <tr>
                                        <td class="mono">${shortenHash(t.tx_hash)}</td>
                                        <td class="mono">${shortenHash(t.from)}</td>
                                        <td class="mono">${shortenHash(t.to)}</td>
                                        <td>${t.token_symbol || "?"}</td>
                                        <td>${formatNumber(from18(t.value || 0))}</td>
                                    </tr>`
                                    )
                                    .join("")}
                            </tbody>
                        </table>
                    `;
                }
            } catch (err) {
                console.error("transfers error:", err);
                document.getElementById("addr-transfers").innerHTML =
                    `<p class="placeholder">Error loading token transfers</p>`;
            }
        }

        async function initDashboard() {
            await Promise.all([
                loadStats(),
                loadCharts(),
                loadLatestTransactions(),
                loadTopAccounts()
            ]);
        }

        document.addEventListener("DOMContentLoaded", initDashboard);
    </script>
</body>
</html>
