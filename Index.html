<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Caf√© Blockchain Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Chart.js voor de grafieken -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="background-overlay"></div>

    <header class="top-bar">
        <div class="logo-area">
            <div class="logo-circle">‚òïÔ∏è</div>
            <div class="logo-text">
                <span class="logo-main">Caf√© Chain</span>
                <span class="logo-sub">Powered by LadyScan</span>
            </div>
        </div>
        <div class="network-pill">
            <span class="dot"></span>
            <span id="network-name">Mainnet</span>
        </div>
    </header>

    <main class="dashboard-container">
        <section class="hero">
            <div>
                <h1>Welkom in het Blockchain Caf√©</h1>
                <p class="hero-subtitle">
                    Pak een kop koffie en bekijk de groei van je chain:
                    blokken, wallets, transacties en meer ‚Äì alles live.
                </p>
            </div>
            <div class="hero-badge">
                <span class="badge-label">Live chain health</span>
                <span id="last-updated" class="badge-value">‚Äì</span>
            </div>
        </section>

        <!-- Stat cards -->
        <section class="cards">
            <article class="card">
                <div class="card-header">
                    <span class="card-icon">üì¶</span>
                    <h2>Blokken</h2>
                </div>
                <p class="card-label">Totaal aantal blokken</p>
                <p id="block-count" class="card-value">‚Äì</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">üëõ</span>
                    <h2>Wallets</h2>
                </div>
                <p class="card-label">Unieke adressen</p>
                <p id="wallet-count" class="card-value">‚Äì</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">üí∏</span>
                    <h2>Transacties</h2>
                </div>
                <p class="card-label">Totaal aantal transacties</p>
                <p id="transaction-count" class="card-value">‚Äì</p>
            </article>
        </section>

        <!-- Grafiek: groei van transacties per dag -->
        <section class="panel">
            <div class="panel-header">
                <div>
                    <h2>Dagelijkse groei</h2>
                    <p class="panel-subtitle">
                        Aantal transacties per dag ‚Äì laat zien hoe levendig jouw caf√©-chain is.
                    </p>
                </div>
            </div>
            <div class="panel-body">
                <canvas id="growthChart"></canvas>
            </div>
        </section>

        <section class="two-column">
            <!-- Laatste transacties -->
            <section class="panel">
                <div class="panel-header">
                    <div>
                        <h2>Laatste transacties</h2>
                        <p class="panel-subtitle">
                            De meest recente bewegingen in de chain.
                        </p>
                    </div>
                </div>
                <div class="panel-body table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Hash</th>
                                <th>Van</th>
                                <th>Naar</th>
                                <th>Waarde</th>
                                <th>Tijd</th>
                            </tr>
                        </thead>
                        <tbody id="latest-transactions-body">
                            <tr><td colspan="5" class="placeholder">Laden‚Ä¶</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Grootste wallets -->
            <section class="panel">
                <div class="panel-header">
                    <div>
                        <h2>Grootste wallets</h2>
                        <p class="panel-subtitle">
                            De rijkste accounts aan de bar.
                        </p>
                    </div>
                </div>
                <div class="panel-body table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Adres</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="top-accounts-body">
                            <tr><td colspan="3" class="placeholder">Laden‚Ä¶</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </section>
    </main>

    <footer class="footer">
        Gemaakt met ‚òïÔ∏è &amp; üíª ‚Äì live data van <code>ladyscan.us</code>
    </footer>

    <script>
        const API_BASE = "https://ladyscan.us/api/v2";

        function formatNumber(value) {
            if (value === null || value === undefined) return "‚Äì";
            try {
                return Number(value).toLocaleString("nl-NL");
            } catch {
                return String(value);
            }
        }

        function shortenHash(hash, length = 10) {
            if (!hash) return "‚Äì";
            if (hash.length <= length) return hash;
            return hash.slice(0, 6) + "‚Ä¶" + hash.slice(-4);
        }

        function formatTimestamp(ts) {
            if (!ts) return "‚Äì";
            const d = new Date(ts);
            if (isNaN(d.getTime())) return ts;
            return d.toLocaleString("nl-NL");
        }

        async function fetchJson(path, params = "") {
            const url = API_BASE + path + params;
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error("API error " + response.status + " bij " + url);
            }
            return response.json();
        }

        async function loadStats() {
            try {
                const data = await fetchJson("/stats");

                // üëâ HIER: controleer even in de browser-console hoe 'data' eruitziet
                console.log("Stats response:", data);

                // Deze velden zijn een aanname. Pas ze aan als de echte keys anders heten:
                const blockCount = data.blocks  data.block_count  data.latest_block || data.blockNumber;
                const addressCount = data.addresses  data.address_count  data.wallets;
                const txCount = data.transactions  data.tx_count  data.total_transactions;

                document.getElementById("block-count").innerText = formatNumber(blockCount);
                document.getElementById("wallet-count").innerText = formatNumber(addressCount);
                document.getElementById("transaction-count").innerText = formatNumber(txCount);

                document.getElementById("last-updated").innerText =
                    "Bijgewerkt: " + new Date().toLocaleTimeString("nl-NL");
            } catch (err) {
                console.error(err);
            }
        }

        async function loadCharts() {
            try {
                const data = await fetchJson("/stats/charts");

                // üëâ Even in de console kijken:
                console.log("Charts response:", data);

                // Voorbeeld-aanname:
                // data.daily_transactions = [{ date: "2025-11-15", value: 123 }, ...]
                const daily = data.daily_transactions  data.tx_per_day  data.transactions || [];

                const labels = daily.map((item) => item.date  item.day  item.
                timestamp || "");
                const values = daily.map((item) => item.value  item.tx_count  item.transactions || 0);

                const ctx = document.getElementById("growthChart").getContext("2d");
                new Chart(ctx, {
                    type: "line",
                    data: {
                        labels,
                        datasets: [
                            {
                                label: "Transacties per dag",
                                data: values,
                                borderWidth: 2,
                                tension: 0.25,
                                pointRadius: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    font: { family: "'Inter', Arial, sans-serif" }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    font: { family: "'Inter', Arial, sans-serif" }
                                }
                            },
                            y: {
                                ticks: {
                                    font: { family: "'Inter', Arial, sans-serif" }
                                }
                            }
                        }
                    }
                });
            } catch (err) {
                console.error(err);
            }
        }

        async function loadLatestTransactions() {
            try {
                const data = await fetchJson("/main-page/transactions");
                console.log("Latest tx response:", data);

                const tbody = document.getElementById("latest-transactions-body");
                tbody.innerHTML = "";

                const items = data.items  data.transactions  data || [];
                if (!items.length) {
                    tbody.innerHTML = '<tr><td colspan="5" class="placeholder">Geen transacties gevonden</td></tr>';
                    return;
                }

                items.slice(0, 10).forEach((tx) => {
                    const tr = document.createElement("tr");

                    const hash = tx.hash  tx.tx_hash  tx.id;
                    const from = tx.from  tx.sender  tx.from_address;
                    const to = tx.to  tx.receiver  tx.to_address;
                    const value = tx.value  tx.amount  tx.value_formatted;
                    const timestamp = tx.timestamp  tx.time  tx.block_time;

                    tr.innerHTML =
                        <td title="${hash || ""}">${shortenHash(hash)}</td>;
                        <td title="${from  ""}">${shortenHash(from  "")}</td>;
                        <td title="${to  ""}">${shortenHash(to  "")}</td>;
                        <td>${value !== undefined ? value : "‚Äì"}</td>;
                        <td>${formatTimestamp(timestamp)}</td>;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error(err);
                const tbody = document.getElementById("latest-transactions-body");
                tbody.innerHTML =
                    '<tr><td colspan="5" class="placeholder">Fout bij laden van transacties</td></tr>';
            }
        }

        async function loadTopAccounts() {
            try {
                const data = await fetchJson("/stats/top-accounts");
                console.log("Top accounts response:", data);

                const tbody = document.getElementById("top-accounts-body");
                tbody.innerHTML = "";

                const items = data.items  data.accounts  data || [];
                if (!items.length) {
                    tbody.
                    innerHTML = '<tr><td colspan="3" class="placeholder">Geen data gevonden</td></tr>';
                    return;
                }

                items.slice(0, 10).forEach((acc, index) => {
                    const address = acc.address  acc.account  acc.wallet;
                    const balance = acc.balance  acc.value  acc.amount;

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td title="${address  ""}">${shortenHash(address  "", 14)}</td>
                        <td>${balance !== undefined ? balance : "‚Äì"}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error(err);
                const tbody = document.getElementById("top-accounts-body");
                tbody.innerHTML =
                    '<tr><td colspan="3" class="placeholder">Fout bij laden van grootste wallets</td></tr>';
            }
        }

        async function initDashboard() {
            await Promise.all([
                loadStats(),
                loadCharts(),
                loadLatestTransactions(),
                loadTopAccounts()
            ]);
        }

        document.addEventListener("DOMContentLoaded", initDashboard);
    </script>
</body>
</html>