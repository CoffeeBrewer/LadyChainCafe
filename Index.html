<!DOCTYPE html>
<html lang="en">
<head:
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LadyChain CafÃ© Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="background-overlay"></div>

    <header class="top-bar">
        <div class="logo-area">
            <div class="logo-circle">
                <!-- Als je een eigen logo hebt:
                <img src="ladychain-logo.svg" alt="LadyChain Logo" class="logo-img" />
                -->
                <span class="logo-initials">LC</span>
            </div>
            <div class="logo-text">
                <span class="logo-main">LadyChain CafÃ©</span>
                <span class="logo-sub">Explorer dashboard for LadyChain</span>
            </div>
        </div>
        <div class="network-pill">
            <span class="dot"></span>
            <span id="network-name">LadyChain Mainnet</span>
        </div>
    </header>

    <main class="dashboard-container">
        <section class="hero fade-in">
            <div>
                <h1>Welcome to the LadyChain CafÃ©</h1>
                <p class="hero-subtitle">
                    Grab a coffee and watch LadyChain grow â€” blocks, wallets, transactions,
                    gas and network health, all in real time.
                </p>
            </div>

            <div class="hero-badge">
                <span class="badge-label">Live network health</span>
                <span id="last-updated" class="badge-value skeleton">Loadingâ€¦</span>
            </div>
        </section>

        <!-- MAIN STATS CARDS -->
        <section class="cards fade-in">
            <article class="card">
                <div class="card-header">
                    <span class="card-icon">ðŸ“¦</span>
                    <h2>Blocks</h2>
                </div>
                <p class="card-label">Total blocks on LadyChain</p>
                <p id="block-count" class="card-value skeleton">â€“</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">ðŸ‘›</span>
                    <h2>Wallets</h2>
                </div>
                <p class="card-label">Unique LadyChain addresses</p>
                <p id="wallet-count" class="card-value skeleton">â€“</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">ðŸ’¸</span>
                    <h2>Total Transactions</h2>
                </div>
                <p class="card-label">All transactions on LadyChain</p>
                <p id="transaction-count" class="card-value skeleton">â€“</p>
            </article>

            <article class="card">
                <div class="card-header">
                    <span class="card-icon">â˜•</span>
                    <h2>Transactions Today</h2>
                </div>
                <p class="card-label">Daily activity on LadyChain</p>
                <p id="transaction-today" class="card-value skeleton">â€“</p>
            </article>
        </section>

        <!-- NETWORK METRICS STRIP -->
        <section class="metrics-row fade-in">
            <div class="metric-pill">
                <span class="metric-label">Avg block time</span>
                <span id="metric-avg-block-time" class="metric-value skeleton">â€“</span>
            </div>
            <div class="metric-pill">
                <span class="metric-label">Approx. TPS</span>
                <span id="metric-tps" class="metric-value skeleton">â€“</span>
            </div>
            <div class="metric-pill">
                <span class="metric-label">Network utilization</span>
                <span id="metric-utilization" class="metric-value skeleton">â€“</span>
            </div>
            <div class="metric-pill">
                <span class="metric-label">TVL</span>
                <span id="metric-tvl" class="metric-value skeleton">â€“</span>
            </div>
        </section>

        <!-- DAILY GROWTH + GAS -->
        <section class="panel fade-in">
            <div class="panel-header">
                <div>
                    <h2>LadyChain Daily Growth</h2>
                    <p class="panel-subtitle">
                        Transactions per day â€” see how active LadyChain is over time.
                    </p>
                </div>
            </div>
            <div class="panel-body">
                <canvas id="growthChart"></canvas>

                <div class="gas-badges">
                    <div class="gas-badge">
                        <span class="gas-label">Low gas</span>
                        <span id="gas-low" class="gas-value skeleton">â€“</span>
                    </div>
                    <div class="gas-badge">
                        <span class="gas-label">Average gas</span>
                        <span id="gas-avg" class="gas-value skeleton">â€“</span>
                    </div>
                    <div class="gas-badge">
                        <span class="gas-label">High gas</span>
                        <span id="gas-high" class="gas-value skeleton">â€“</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="two-column">
            <!-- LATEST TX -->
            <section class="panel fade-in">
                <div class="panel-header">
                    <div>
                        <h2>Latest LadyChain Transactions</h2>
                        <p class="panel-subtitle">
                            The most recent transfers and contract interactions on LadyChain.
                        </p>
                    </div>
                </div>
                <div class="panel-body table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Hash</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Value</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="latest-transactions-body">
                            <tr><td colspan="5" class="placeholder">Loading latest transactionsâ€¦</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- RICHEST WALLETS -->
            <section class="panel fade-in">
                <div class="panel-header">
                    <div>
                        <h2>Richest LadyChain Wallets</h2>
                        <p class="panel-subtitle">
                            Top addresses by balance on LadyChain.
                        </p>
                    </div>
                </div>
                <div class="panel-body table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Address</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="top-accounts-body">
                            <tr><td colspan="3" class="placeholder">Loading top walletsâ€¦</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </section>
    </main>

    <footer class="footer">
        Brewed with â˜• & ðŸ’» â€” live data from <code>ladyscan.us</code>
    </footer>

    <script>
        const API_BASE = "https://ladyscan.us/api/v2";

        function formatNumber(value) {
            if (value === null || value === undefined || value === "" || isNaN(value)) {
                return "â€“";
            }
            const num = Number(value);
            return Number(num.toFixed(2)).toLocaleString("en-US");
        }

        function from18(value) {
            if (value === null || value === undefined) return 0;
            try {
                const n = BigInt(value);
                const factor = BigInt("1000000000000000000");
                const whole = Number(n / factor);
                const decimal = Number(n % factor) / 1e18;
                return whole + decimal;
            } catch {
                return Number(value) / 1e18;
            }
        }

        function shortenHash(hash, length = 10) {
            if (!hash) return "â€“";
            if (hash.length <= length) return hash;
            return hash.slice(0, 6) + "â€¦" + hash.slice(-4);
        }

        function formatTimestamp(ts) {
            if (!ts) return "â€“";

            const num = Number(ts);
            if (!isNaN(num)) {
                const ms = num < 1e12 ? num * 1000 : num;
                const d = new Date(ms);
                if (!isNaN(d.getTime())) return d.toLocaleString("en-GB");
            }

            const d2 = new Date(ts);
            if (!isNaN(d2.getTime())) return d2.toLocaleString("en-GB");

            return String(ts);
        }

        function clearSkeleton(id) {
            const el = typeof id === "string" ? document.getElementById(id) : id;
            if (el) el.classList.remove("skeleton");
        }

        async function fetchJson(path, params = "") {
            const url = API_BASE + path + params;
            const response = await fetch(url);
            if (!response.ok) throw new Error("API error " + response.status + " at " + url);
            return response.json();
        }

        // MAIN STATS + METRICS
        async function loadStats() {
            try {
                const data = await fetchJson("/stats");

                const blocks = data.total_blocks;
                const addresses = data.total_addresses;
                const totalTx = data.total_transactions;
                const txToday = Number(data.transactions_today || 0);
                const avgBlockTime = data.average_block_time || data.avg_block_time;
                const utilization = data.network_utilization_percentage;
                const tvl = data.tvl;

                document.getElementById("block-count").innerText = formatNumber(blocks);
                document.getElementById("wallet-count").innerText = formatNumber(addresses);
                document.getElementById("transaction-count").innerText = formatNumber(totalTx);
                document.getElementById("transaction-today").innerText = formatNumber(txToday);

                clearSkeleton("block-count");
                clearSkeleton("wallet-count");
                clearSkeleton("transaction-count");
                clearSkeleton("transaction-today");

                // Metrics
                const tps = txToday / 86400; // simple approximation
                document.getElementById("metric-avg-block-time").innerText =
                    avgBlockTime ? formatNumber(avgBlockTime) + " s" : "â€“";
                document.getElementById("metric-tps").innerText = formatNumber(tps);
                document.getElementById("metric-utilization").innerText =
                    utilization !== null && utilization !== undefined
                        ? formatNumber(utilization) + " %"
                        : "â€“";
                document.getElementById("metric-tvl").innerText =
                    tvl !== null && tvl !== undefined ? formatNumber(tvl) : "â€“";

                clearSkeleton("metric-avg-block-time");
                clearSkeleton("metric-tps");
                clearSkeleton("metric-utilization");
                clearSkeleton("metric-tvl");

                const updated = document.getElementById("last-updated");
                updated.innerText = "Updated: " + new Date().toLocaleTimeString("en-GB");
                clearSkeleton(updated);
            } catch (err) {
                console.error("loadStats error:", err);
            }
        }

        // DAILY TX CHART + GAS BANDS
        async function loadCharts() {
            try {
                const data = await fetchJson("/stats/charts");

                const daily = data.daily_transactions || [];
                daily.sort((a, b) => new Date(a.date) - new Date(b.date));

                const labels = daily.map((item) => {
                    const d = new Date(item.date);
                    return d.toLocaleDateString("en-GB", {
                        day: "2-digit",
                        month: "short"
                    });
                });

                const values = daily.map((item) => Number(item.count) || 0);

                const ctx = document.getElementById("growthChart").getContext("2d");
                new Chart(ctx, {
                    type: "line",
                    data: {
                        labels,
                        datasets: [
                            {
                                label: "Daily transactions",
                                data: values,
                                borderWidth: 2,
                                tension: 0.25,
                                pointRadius: 3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Gas bands (from charts response)
                if (data.low_gas !== undefined) {
                    const low = formatNumber(data.low_gas) + " gwei";
                    const avg = formatNumber(data.avg_gas_price || data.avg_gas) + " gwei";
                    const high = formatNumber(data.high_gas) + " gwei";

                    const elLow = document.getElementById("gas-low");
                    const elAvg = document.getElementById("gas-avg");
                    const elHigh = document.getElementById("gas-high");

                    elLow.innerText = low;
                    elAvg.innerText = avg;
                    elHigh.innerText = high;

                    clearSkeleton(elLow);
                    clearSkeleton(elAvg);
                    clearSkeleton(elHigh);
                }
            } catch (err) {
                console.error("loadCharts error:", err);
            }
        }

        // LATEST TRANSACTIONS
        async function loadLatestTransactions() {
            try {
                const data = await fetchJson("/main-page/transactions");
                const tbody = document.getElementById("latest-transactions-body");
                tbody.innerHTML = "";

                const items = data.items || [];
                if (!items.length) {
                    tbody.innerHTML =
                        '<tr><td colspan="5" class="placeholder">No transactions found</td></tr>';
                    return;
                }

                items.slice(0, 10).forEach((tx) => {
                    // Values:
                    // - if value_formatted is present, assume it's human-readable
                    // - otherwise, treat value as 18-decimals
                    let displayValue;
                    if (tx.value_formatted !== undefined && tx.value_formatted !== null) {
                        displayValue = Number(tx.value_formatted);
                    } else {
                        displayValue = from18(tx.value || 0);
                    }

                    const timestampRaw =
                        tx.created_at || tx.updated_at || tx.timestamp || tx.time || tx.block_time;

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td title="${tx.hash}">${shortenHash(tx.hash)}</td>
                        <td title="${tx.from_address}">${shortenHash(tx.from_address)}</td>
                        <td title="${tx.to_address}">${shortenHash(tx.to_address)}</td>
                        <td>${formatNumber(displayValue)}</td>
                        <td>${formatTimestamp(timestampRaw)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error("loadLatestTransactions error:", err);
                const tbody = document.getElementById("latest-transactions-body");
                tbody.innerHTML =
                    '<tr><td colspan="5" class="placeholder">Error while loading transactions</td></tr>';
            }
        }

        // RICHEST WALLETS
        async function loadTopAccounts() {
            try {
                const data = await fetchJson("/stats/top-accounts");
                const tbody = document.getElementById("top-accounts-body");
                tbody.innerHTML = "";

                const items = data.items || [];
                if (!items.length) {
                    tbody.innerHTML =
                        '<tr><td colspan="3" class="placeholder">No data found</td></tr>';
                    return;
                }

                items.slice(0, 10).forEach((acc, index) => {
                    const balance = from18(acc.balance || 0);

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td title="${acc.address}">${shortenHash(acc.address, 14)}</td>
                        <td>${formatNumber(balance)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error("loadTopAccounts error:", err);
                const tbody = document.getElementById("top-accounts-body");
                tbody.innerHTML =
                    '<tr><td colspan="3" class="placeholder">Error while loading top wallets</td></tr>';
            }
        }

        async function initDashboard() {
            await Promise.all([
                loadStats(),
                loadCharts(),
                loadLatestTransactions(),
                loadTopAccounts()
            ]);
        }

        document.addEventListener("DOMContentLoaded", initDashboard);
    </script>
</body>
</html>
